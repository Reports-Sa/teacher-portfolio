<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖŸÑŸÅ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖŸáŸÜŸä - ÿßÿ≥ŸÖ ÿßŸÑŸÖÿπŸÑŸÖÿ©</title>
    <meta name="description" content="ŸÖŸÑŸÅ ÿ•ŸÜÿ¨ÿßÿ≤ ÿ™ŸÅÿßÿπŸÑŸä Ÿäÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥Ÿäÿ±ÿ© ÿßŸÑŸÖŸáŸÜŸäÿ© ŸàÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© ŸÑŸÑŸÖÿπŸÑŸÖÿ©.">
    
    <!-- Favicon (can be an SVG emoji) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22> portfolio </text></svg>">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js Core + Persist plugin (for dark mode) -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Libraries: Charts, Lightbox, Animations, Rich Text Editor, PDF Viewer -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <!-- Lightbox dependency -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/core@2.1.12/dist/tiptap-core.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/starter-kit@2.1.12/dist/tiptap-starter-kit.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/html@2.1.12/dist/tiptap-html.umd.min.js"></script>

    <!-- Custom CSS for RTL, Print, and Components -->
    <style>
        /* Base Styles */
        body { font-family: 'Tajawal', sans-serif; /* A nice modern Arabic font */ }
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        /* Tailwind RTL Plugin logic (simulated for CDN) */
        [dir="rtl"] .group:hover .group-hover\:rtl\:block { display: block; }
        /* Add more as needed for complex components */

        /* Print Styles */
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print, .no-print * { display: none !important; }
            .print-break-before { page-break-before: always; }
            .print-a4 { width: 210mm; min-height: 297mm; padding: 15mm; }
            main, section, div, p { background: transparent !important; color: #000 !important; }
        }

        /* Dark Mode */
        .dark { background-color: #111827; color: #f3f4f6; }

        /* Floating Action Button (FAB) */
        .fab { position: fixed; bottom: 2rem; right: 2rem; }
        [dir="rtl"] .fab { right: auto; left: 2rem; }
        @media (max-width: 640px) { /* On XS screens, make it a bottom sheet */
            .fab-menu { position: fixed; bottom: 0; left:0; right:0; transition: transform 0.3s ease; transform: translateY(100%); }
            .fab-menu.open { transform: translateY(0); }
        }

        /* Flip Card */
        .flip-card { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
        .flip-card:hover .flip-card-inner { transform: rotateY(180deg); }
        [dir="rtl"] .flip-card:hover .flip-card-inner { transform: rotateY(-180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; }
        .flip-card-back { transform: rotateY(180deg); }
        [dir="rtl"] .flip-card-back { transform: rotateY(-180deg); }
    </style>
</head>

<body x-data="portfolioApp()" x-init="init()" :class="{ 'dark': darkMode }" :dir="lang === 'ar' ? 'rtl' : 'ltr'">

    <!-- === TOP BAR & SIDE NAV (NO-PRINT) === -->
    <header class="no-print sticky top-0 z-40 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm shadow-sm">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800 dark:text-gray-200" x-text="data.profile.fullName || i18n[lang].loading"></h1>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
                <button @click="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" :aria-label="i18n[lang].toggleTheme">
                    <span x-show="!darkMode">üåô</span><span x-show="darkMode">‚òÄÔ∏è</span>
                </button>
                <button @click="toggleLang()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" :aria-label="i18n[lang].toggleLang">
                    <span x-text="lang === 'ar' ? 'EN' : 'AR'"></span>
                </button>
                <button @click="window.print()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" :aria-label="i18n[lang].print">üñ®Ô∏è</button>
                <button @click="showLoginModal = true" x-show="!isAuthenticated" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm font-semibold hover:bg-green-700">
                    üîí <span x-text="i18n[lang].login"></span>
                </button>
                <button @click="logout()" x-show="isAuthenticated" class="px-4 py-2 bg-red-600 text-white rounded-md text-sm font-semibold hover:bg-red-700">
                    <span x-text="i18n[lang].logout"></span>
                </button>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sticky Side Nav -->
        <nav class="no-print w-64 hidden md:block sticky top-16 h-[calc(100vh-4rem)] p-4 space-y-2 overflow-y-auto bg-gray-50 dark:bg-gray-800">
            <template x-for="section in sections" :key="section.id">
                <a :href="'#' + section.id" @click="activeSection = section.id"
                   :class="{'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 font-bold': activeSection === section.id, 'hover:bg-gray-200 dark:hover:bg-gray-700': activeSection !== section.id}"
                   class="block p-2 rounded-md transition-colors"
                   x-text="section.title[lang]">
                </a>
            </template>
        </nav>

        <!-- === MAIN CONTENT === -->
        <main class="flex-1 p-4 md:p-8 lg:p-12 print-a4">
            <!-- Loading indicator -->
            <div x-show="isLoading" class="text-center p-12">
                <p x-text="i18n[lang].loading"></p>
            </div>
            
            <div x-show="!isLoading" class="space-y-16">
                <!-- 1. Header -->
                <section id="header" class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center" data-aos="fade-up">
                    <div class="md:col-span-1 flex justify-center">
                        <img :src="data.profile.photo" alt="Profile Photo" class="w-48 h-48 rounded-full object-cover shadow-lg border-4 border-green-600">
                    </div>
                    <div class="md:col-span-2 text-center md:text-start rtl:md:text-end">
                        <h2 class="text-4xl font-extrabold text-gray-800 dark:text-white" x-text="data.profile.fullName"></h2>
                        <p class="text-xl text-green-700 dark:text-green-400 mt-1" x-text="`${data.profile.title} | ${data.profile.grade}`"></p>
                        <div class="mt-4 text-gray-600 dark:text-gray-400 space-y-1">
                            <p><strong x-text="i18n[lang].school"></strong>: <span x-text="data.profile.school"></span> (<span x-text="data.profile.administration"></span>)</p>
                            <p><strong x-text="i18n[lang].nationality"></strong>: <span x-text="data.profile.nationality"></span></p>
                            <p><strong x-text="i18n[lang].schoolYear"></strong>: <span x-text="data.profile.schoolYear.gregorian"></span> / <span x-text="data.profile.schoolYear.hijri"></span></p>
                        </div>
                    </div>
                </section>
                
                <!-- ... other sections will be added here ... -->

                <!-- All other 10 sections go here, following a similar pattern of data-binding and conditional rendering -->
                <!-- Example: About Section -->
                <section id="about" data-aos="fade-up">
                    <div class="relative">
                        <h3 class="text-3xl font-bold mb-4" x-text="i18n[lang].about"></h3>
                        <button x-show="isEditing" @click="openEditModal('about')" class="absolute top-0 end-0 p-2 text-xl">‚úèÔ∏è</button>
                    </div>
                    <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-inner space-y-4">
                        <p class="text-lg leading-relaxed" x-text="data.about.bio"></p>
                        <blockquote class="border-s-4 border-green-600 ps-4 italic">
                            <p class="font-semibold" x-text="data.about.philosophy"></p>
                        </blockquote>
                    </div>
                </section>

                 <!-- 5. KPI Dashboard -->
                <section id="kpis" data-aos="fade-up">
                    <h3 class="text-3xl font-bold mb-6" x-text="i18n[lang].kpiDashboard"></h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-center">
                        <template x-for="kpi in data.kpis" :key="kpi.id">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md relative">
                                <div x-show="isEditing" class="absolute top-1 end-1 space-x-1">
                                    <button @click="openEditModal('kpi', kpi)" class="text-xs">‚úèÔ∏è</button>
                                    <button @click="deleteItem('kpis', kpi.id)" class="text-xs">üóëÔ∏è</button>
                                </div>
                                <div class="text-4xl font-bold text-green-600" x-text="kpi.value + kpi.unit">0%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2" x-text="kpi.label[lang]"></p>
                            </div>
                        </template>
                         <div x-show="isEditing" class="flex items-center justify-center">
                            <button @click="openAddModal('kpi')" class="text-5xl text-gray-300 hover:text-green-500">+</button>
                        </div>
                    </div>
                </section>

                <!-- 9. Awards & Recognition (Flip Cards) -->
                <section id="awards" data-aos="fade-up">
                     <h3 class="text-3xl font-bold mb-6" x-text="i18n[lang].awards"></h3>
                     <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
                        <template x-for="award in data.awards" :key="award.id">
                            <div class="flip-card aspect-[3/4]">
                                <div class="flip-card-inner rounded-lg shadow-lg">
                                    <div class="flip-card-front bg-gray-200 dark:bg-gray-700 flex items-center justify-center p-4">
                                        <img :src="award.frontImage" class="max-h-full max-w-full object-contain" :alt="award.title[lang]">
                                    </div>
                                    <div class="flip-card-back bg-green-600 text-white flex flex-col items-center justify-center p-4 rounded-lg">
                                        <h4 class="font-bold text-lg text-center" x-text="award.title[lang]"></h4>
                                        <p class="text-sm mt-2 text-center" x-text="award.description[lang]"></p>
                                        <p class="text-xs mt-4" x-text="award.date"></p>
                                    </div>
                                </div>
                                <div x-show="isEditing" class="absolute -top-2 -end-2 z-10">
                                    <button @click="deleteItem('awards', award.id)" class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">üóëÔ∏è</button>
                                </div>
                            </div>
                        </template>
                         <div x-show="isEditing" class="flex items-center justify-center border-2 border-dashed rounded-lg">
                            <button @click="openAddModal('award')" class="text-5xl text-gray-300 hover:text-green-500">+</button>
                        </div>
                     </div>
                </section>
                
                <!-- More sections here... -->
            </div>
        </main>
    </div>

    <!-- === EDITING FAB (FLOATING ACTION BUTTON) === -->
    <div class="no-print fab">
        <div x-show="isAuthenticated">
            <button @click="toggleEdit()" class="w-16 h-16 bg-green-600 text-white rounded-full shadow-lg flex items-center justify-center text-3xl hover:bg-green-700 transition-transform hover:scale-110">
                <span x-show="!isEditing">üñâ</span>
                <span x-show="isEditing">üëÅÔ∏è</span>
            </button>
        </div>
    </div>
    
    <!-- Save/Cancel Banner in Edit Mode -->
    <div x-show="isEditing" x-transition class="no-print fixed bottom-0 left-0 right-0 bg-gray-800 p-4 shadow-lg flex justify-center items-center gap-4 z-50">
        <p class="text-white" x-text="i18n[lang].unsavedChanges"></p>
        <button @click="saveChanges()" :disabled="isSaving" class="px-6 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-700 disabled:bg-gray-500">
            <span x-show="!isSaving" x-text="i18n[lang].save"></span>
            <span x-show="isSaving">... <span x-text="i18n[lang].saving"></span></span>
        </button>
        <button @click="cancelChanges()" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700" x-text="i18n[lang].cancel"></button>
    </div>

    <!-- === MODALS === -->
    <!-- Login Modal -->
    <div x-show="showLoginModal" x-transition.opacity class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div @click.away="showLoginModal = false" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm" dir="rtl">
            <h3 class="text-2xl font-bold text-center mb-6" x-text="i18n.ar.login"></h3>
            <form @submit.prevent="login()">
                <div class="mb-4">
                    <label for="password" class="block mb-2 text-sm font-medium" x-text="i18n.ar.password"></label>
                    <input type="password" id="password" x-model="passwordInput" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" required>
                </div>
                <p x-show="loginError" class="text-red-500 text-sm mb-4" x-text="loginError"></p>
                <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md font-bold hover:bg-green-700" x-text="i18n.ar.loginAction"></button>
            </form>
        </div>
    </div>

    <!-- Fallback Save Banner -->
    <div x-show="showFallbackBanner" class="no-print fixed top-0 left-0 right-0 bg-red-600 text-white p-3 text-center z-50">
        <span x-text="i18n[lang].fallbackSave"></span>
    </div>

    <!-- Toast Notification -->
    <div x-show="toast.show" x-transition x-text="toast.message" :class="toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'" 
         class="fixed bottom-24 end-4 rtl:end-auto rtl:start-4 p-4 rounded-lg text-white shadow-lg z-50">
    </div>


    <!-- ======================= JAVASCRIPT LOGIC ======================= -->
    <script>
        function portfolioApp() {
            return {
                // STATE
                lang: 'ar',
                darkMode: this.$persist(false).as('portfolio-dark-mode'),
                isLoading: true,
                isAuthenticated: false,
                isEditing: false,
                isSaving: false,
                showLoginModal: false,
                showFallbackBanner: false,
                passwordInput: '',
                loginError: '',
                activeSection: 'header',
                toast: { show: false, message: '', type: 'success' },
                
                // DATA
                data: {},
                originalData: {}, // For cancellation
                filesToUpload: {}, // { "path/filename.ext": "base64string" }

                // UI TEXT
                i18n: {
                    ar: {
                        loading: "ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...",
                        login: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
                        logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
                        password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                        loginAction: "ÿØÿÆŸàŸÑ",
                        editMode: "Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±",
                        save: "ÿ≠ŸÅÿ∏ ŸàŸÜÿ¥ÿ±",
                        saving: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...",
                        cancel: "ÿ•ŸÑÿ∫ÿßÿ°",
                        unsavedChanges: "ÿ£ŸÜÿ™ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±. ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ŸÅŸàÿ∏ÿ©.",
                        fallbackSave: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑŸÜÿ¥ÿ± ÿπŸÑŸâ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™. ÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ŸÉ. ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã.",
                        saveSuccess: "ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ŸÑŸÑÿ¨ŸÖŸäÿπ ÿÆŸÑÿßŸÑ ŸÑÿ≠ÿ∏ÿßÿ™.",
                        saveError: "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ≠ŸÅÿ∏. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
                        toggleTheme: "ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÖÿ∏Ÿáÿ±",
                        toggleLang: "Switch to English",
                        print: "ÿ∑ÿ®ÿßÿπÿ©/PDF",
                        school: "ÿßŸÑŸÖÿØÿ±ÿ≥ÿ©",
                        nationality: "ÿßŸÑÿ¨ŸÜÿ≥Ÿäÿ©",
                        schoolYear: "ÿßŸÑÿπÿßŸÖ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä",
                        about: "ŸÜÿ®ÿ∞ÿ© ÿπŸÜŸä Ÿàÿ±ÿ§Ÿäÿ™Ÿä ÿßŸÑÿ™ÿ±ÿ®ŸàŸäÿ©",
                        kpiDashboard: "ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
                        awards: "ÿßŸÑÿ¨Ÿàÿßÿ¶ÿ≤ ŸàÿßŸÑÿ¥ŸáÿßÿØÿßÿ™",
                        // ... add all other labels
                    },
                    en: {
                        loading: "Loading...",
                        login: "Login",
                        logout: "Logout",
                        password: "Password",
                        loginAction: "Enter",
                        editMode: "Edit Mode",
                        save: "Save & Publish",
                        saving: "Saving...",
                        cancel: "Cancel",
                        unsavedChanges: "You are in edit mode. Changes are not saved.",
                        fallbackSave: "Could not publish online. A backup was saved in your browser. Please try again later.",
                        saveSuccess: "Saved successfully! The update will be live for everyone in a few moments.",
                        saveError: "An error occurred while saving. Please try again.",
                        toggleTheme: "Toggle Theme",
                        toggleLang: "ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ŸÑŸÑÿπÿ±ÿ®Ÿäÿ©",
                        print: "Print/PDF",
                        school: "School",
                        nationality: "Nationality",
                        schoolYear: "School Year",
                        about: "About Me & Teaching Philosophy",
                        kpiDashboard: "Key Performance Indicators",
                        awards: "Awards & Recognition",
                        // ... add all other labels
                    }
                },
                sections: [ // For scroll spy
                    {id: 'header', title: {ar: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', en: 'Header'}},
                    {id: 'about', title: {ar: 'ÿßŸÑŸÜÿ®ÿ∞ÿ© ŸàÿßŸÑÿ±ÿ§Ÿäÿ©', en: 'About'}},
                    {id: 'career', title: {ar: 'ÿßŸÑÿ≥Ÿäÿ±ÿ© ÿßŸÑŸÖŸáŸÜŸäÿ©', en: 'Career'}},
                    {id: 'development', title: {ar: 'ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÖŸáŸÜŸä', en: 'Development'}},
                    {id: 'kpis', title: {ar: 'ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ°', en: 'KPIs'}},
                    {id: 'lessons', title: {ar: 'ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿØÿ±Ÿàÿ≥', en: 'Lessons'}},
                    {id: 'evidence', title: {ar: 'ÿ¥ŸàÿßŸáÿØ ÿßŸÑÿ∑ŸÑÿßÿ®', en: 'Evidence'}},
                    {id: 'assessment', title: {ar: 'ÿßŸÑÿ™ŸÇŸàŸäŸÖ ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ', en: 'Assessment'}},
                    {id: 'awards', title: {ar: 'ÿßŸÑÿ¨Ÿàÿßÿ¶ÿ≤', en: 'Awards'}},
                    {id: 'standards', title: {ar: 'ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ£ÿØÿßÿ°', en: 'Standards'}},
                    {id: 'growth', title: {ar: 'ÿÆÿ∑ÿ© ÿßŸÑŸÜŸÖŸà', en: 'Growth Plan'}},
                ],

                // METHODS
                init() {
                    this.fetchData();
                    this.initScrollSpy();
                    AOS.init({ once: true, duration: 600 });
                    
                    // Check for fallback data
                    const fallbackData = localStorage.getItem('portfolio-fallback-data');
                    if (fallbackData) {
                        this.showFallbackBanner = true;
                    }

                    // Check for existing token
                    const token = localStorage.getItem('auth-token');
                    if (token) { // In a real app, you'd verify this token
                        this.isAuthenticated = true;
                    }
                },

                fetchData() {
                    this.isLoading = true;
                    // Add a cache-busting parameter to always get the latest version from GitHub
                    fetch(`data.json?v=${new Date().getTime()}`)
                        .then(response => response.json())
                        .then(jsonData => {
                            this.data = jsonData;
                            this.originalData = JSON.parse(JSON.stringify(jsonData)); // Deep copy for cancellation
                            this.isLoading = false;
                            document.title = `ŸÖŸÑŸÅ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖŸáŸÜŸä - ${this.data.profile.fullName}`;
                            
                            // Let Alpine update the DOM, then init charts
                            this.$nextTick(() => {
                                // this.initCharts();
                            });
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                            this.isLoading = false;
                        });
                },

                toggleLang() {
                    this.lang = this.lang === 'ar' ? 'en' : 'ar';
                    document.documentElement.lang = this.lang;
                    document.documentElement.dir = this.lang === 'ar' ? 'rtl' : 'ltr';
                },

                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                },

                initScrollSpy() {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                this.activeSection = entry.target.id;
                            }
                        });
                    }, { rootMargin: "-50% 0px -50% 0px" });

                    this.sections.forEach(s => {
                        const el = document.getElementById(s.id);
                        if (el) observer.observe(el);
                    });
                },

                login() {
                    // This is a simplified "login". The real verification happens in the Cloudflare Worker.
                    // Here, we just store the password to be sent with the save request.
                    if (this.passwordInput) {
                        localStorage.setItem('auth-token', btoa(this.passwordInput)); // Simple obfuscation for demo
                        this.isAuthenticated = true;
                        this.showLoginModal = false;
                        this.loginError = '';
                    } else {
                        this.loginError = this.i18n[this.lang].password;
                    }
                },

                logout() {
                    this.isAuthenticated = false;
                    this.isEditing = false;
                    localStorage.removeItem('auth-token');
                    this.passwordInput = '';
                },

                toggleEdit() {
                    if (!this.isEditing) {
                        this.isEditing = true;
                        // When entering edit mode, check if there's fallback data
                        const fallbackData = localStorage.getItem('portfolio-fallback-data');
                        if (fallbackData) {
                            if (confirm(this.i18n[this.lang].loadFallbackConfirm)) {
                                this.data = JSON.parse(fallbackData);
                            }
                        }
                    } else {
                        this.isEditing = false;
                        this.cancelChanges(); // Revert to original data when leaving edit mode
                    }
                },

                cancelChanges() {
                    this.data = JSON.parse(JSON.stringify(this.originalData)); // Revert to original
                    this.filesToUpload = {};
                    this.isEditing = false;
                },

                async saveChanges() {
                    this.isSaving = true;
                    
                    const password = atob(localStorage.getItem('auth-token'));
                    if (!password) {
                        this.showToast('You must be logged in to save.', 'error');
                        this.isSaving = false;
                        return;
                    }

                    const payload = {
                        repo: "teacher-amal-portfolio", // This should be configured
                        password: password,
                        files: {
                            ...this.filesToUpload,
                            'data.json': JSON.stringify(this.data, null, 2)
                        },
                        author: {
                            name: this.data.profile.fullName || "Portfolio Editor",
                            email: this.data.profile.email || "portfolio@example.com"
                        }
                    };

                    try {
                        const response = await fetch('https://teacher-portfolio-api.9hazi-des.workers.dev/commit', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (response.ok && result.status === 'ok') {
                            this.showToast(this.i18n[this.lang].saveSuccess, 'success');
                            this.isEditing = false;
                            this.filesToUpload = {};
                            localStorage.removeItem('portfolio-fallback-data'); // Clear fallback on success
                            this.showFallbackBanner = false;
                            // Refresh data from source after a short delay to allow GitHub Pages to rebuild
                            setTimeout(() => this.fetchData(), 5000);
                        } else {
                            throw new Error(result.message || 'Unknown error');
                        }
                    } catch (error) {
                        console.error('Save failed:', error);
                        this.showToast(this.i18n[this.lang].saveError, 'error');
                        // Fallback to localStorage
                        localStorage.setItem('portfolio-fallback-data', JSON.stringify(this.data));
                        this.showFallbackBanner = true;
                    } finally {
                        this.isSaving = false;
                    }
                },
                
                handleFileUpload(event, targetPath) {
                    const files = event.target.files;
                    if (!files) return;

                    for (const file of files) {
                        if (file.size > 5 * 1024 * 1024) {
                            alert(`File ${file.name} is too large (max 5MB).`);
                            continue;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const base64String = e.target.result.split(',')[1];
                            const filePath = `${targetPath}/${file.name}`;
                            this.filesToUpload[filePath] = base64String;
                            // You might want to update a preview in the UI here
                            console.log(`File staged for upload: ${filePath}`);
                        };
                        reader.readAsDataURL(file);
                    }
                },

                showToast(message, type = 'success') {
                    this.toast.message = message;
                    this.toast.type = type;
                    this.toast.show = true;
                    setTimeout(() => this.toast.show = false, 4000);
                }
                
                // Add/Edit/Delete methods would go here...
                // openAddModal(type), openEditModal(type, item), deleteItem(arrayName, id), etc.
            }
        }
    </script>
</body>
</html>
