<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملف الإنجاز المهني</title>
    <meta name="description" content="ملف إنجاز تفاعلي يعرض المسيرة المهنية والأكاديمية للمعلمة.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22> portfolio </text></svg>">
    
    <!-- External Libraries (CSS and JS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; transition: background-color 0.3s, color 0.3s; }
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print, .no-print * { display: none !important; }
            section { page-break-inside: avoid; }
            .print-a4 { width: 210mm; min-height: 297mm; padding: 15mm; }
            main, section, div, p { background: transparent !important; color: #000 !important; }
        }
        .dark { background-color: #111827; color: #f3f4f6; }
        .fab { position: fixed; bottom: 2rem; right: 2rem; z-index: 50; }
        [dir="rtl"] .fab { right: auto; left: 2rem; }
        .flip-card { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
        .flip-card:hover .flip-card-inner { transform: rotateY(180deg); }
        [dir="rtl"] .flip-card:hover .flip-card-inner { transform: rotateY(-180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 0.5rem; overflow: hidden; }
        .flip-card-back { transform: rotateY(180deg); }
        [dir="rtl"] .flip-card-back { transform: rotateY(-180deg); }
    </style>

    <!-- =================================================================== -->
    <!-- ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ -->
    <!-- The entire JavaScript Logic block is NOW MOVED TO THE HEAD SECTION -->
    <!-- =================================================================== -->
    <script>
        function portfolioApp() {
            return {
                // --- STATE MANAGEMENT ---
                lang: 'ar',
                darkMode: this.$persist(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches).as('portfolio-dark-mode'),
                isLoading: true,
                loadingError: null,
                isAuthenticated: false,
                isEditing: false,
                isSaving: false,
                showLoginModal: false,
                showFallbackBanner: false,
                passwordInput: '',
                loginError: '',
                activeSection: 'header',
                toast: { show: false, message: '', type: 'success' },

                // --- DATA ---
                data: { profile: { fullName: "..." } }, // Default structure to prevent errors on load
                originalData: {},
                filesToUpload: {},

                // --- I18N (Internationalization) ---
                i18n: {
                    ar: { loading: "جار التحميل...", login: "تسجيل الدخول", logout: "تسجيل الخروج", password: "كلمة المرور", loginAction: "دخول", save: "حفظ ونشر", saving: "جاري الحفظ...", cancel: "إلغاء", unsavedChanges: "أنت في وضع التحرير. التغييرات غير محفوظة.", fallbackSave: "لم يتم النشر. تم حفظ نسخة احتياطية في متصفحك.", saveSuccess: "تم الحفظ بنجاح! سيظهر التحديث للجميع خلال لحظات.", saveError: "حدث خطأ أثناء الحفظ. يرجى المحاولة مرة أخرى.", toggleTheme: "تبديل المظهر", toggleLang: "Switch to English", print: "طباعة/PDF", school: "المدرسة", nationality: "الجنسية", schoolYear: "العام الدراسي" },
                    en: { loading: "Loading...", login: "Login", logout: "Logout", password: "Password", loginAction: "Enter", save: "Save & Publish", saving: "Saving...", cancel: "Cancel", unsavedChanges: "You are in edit mode. Changes are not saved.", fallbackSave: "Could not publish. A backup was saved in your browser.", saveSuccess: "Saved successfully! The update will be live shortly.", saveError: "An error occurred while saving. Please try again.", toggleTheme: "Toggle Theme", toggleLang: "التحويل للعربية", print: "Print/PDF", school: "School", nationality: "Nationality", schoolYear: "School Year" }
                },

                // --- METHODS ---
                init() {
                    this.fetchData();
                    // ... other init calls can go here
                },

                fetchData() {
                    this.isLoading = true;
                    this.loadingError = null;
                    fetch(`./data.json?v=${new Date().getTime()}`)
                        .then(response => {
                            if (!response.ok) throw new Error(`Failed to load data.json: ${response.status} ${response.statusText}`);
                            return response.json();
                        })
                        .then(jsonData => {
                            this.data = jsonData;
                            this.originalData = JSON.parse(JSON.stringify(jsonData));
                            document.title = this.data.profile.fullName || "ملف الإنجاز المهني";
                            this.$nextTick(() => AOS.init({ once: true, duration: 600 }));
                        })
                        .catch(error => {
                            console.error('Fetch Data Error:', error);
                            this.loadingError = `فشل تحميل ملف 'data.json'. تأكد من وجود الملف وصحة تنسيقه. السبب: ${error.message}`;
                        })
                        .finally(() => {
                            this.isLoading = false;
                        });
                },

                async saveChanges() {
                    this.isSaving = true;
                    const password = atob(localStorage.getItem('auth-token') || '');
                    if (!password) {
                        this.showToast('يجب تسجيل الدخول أولاً للحفظ', 'error');
                        this.isSaving = false;
                        return;
                    }
                    const payload = {
                        repo: "teacher-amal-portfolio", // Configure this
                        password: password,
                        files: { ...this.filesToUpload, 'data.json': JSON.stringify(this.data, null, 2) },
                        author: { name: this.data.profile.fullName, email: this.data.profile.email || "portfolio@example.com" }
                    };
                    try {
                        // IMPORTANT: Update this URL to your Cloudflare Worker URL
                        const response = await fetch('https://teacher-portfolio-api.reports-sa.workers.dev/commit', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        if (!response.ok) throw new Error(result.message || 'Unknown worker error');
                        this.showToast(this.i18n[this.lang].saveSuccess, 'success');
                        this.isEditing = false;
                        this.filesToUpload = {};
                        localStorage.removeItem('portfolio-fallback-data');
                        this.showFallbackBanner = false;
                        setTimeout(() => this.fetchData(), 5000);
                    } catch (error) {
                        console.error('Save Changes Error:', error);
                        this.showToast(this.i18n[this.lang].saveError, 'error');
                        localStorage.setItem('portfolio-fallback-data', JSON.stringify(this.data));
                        this.showFallbackBanner = true;
                    } finally {
                        this.isSaving = false;
                    }
                },
                
                // Other helper methods
                toggleLang() { this.lang = this.lang === 'ar' ? 'en' : 'ar'; },
                toggleDarkMode() { this.darkMode = !this.darkMode; },
                login() { /* ... login logic ... */ },
                logout() { /* ... logout logic ... */ },
                toggleEdit() { this.isEditing = !this.isEditing; },
                showToast(message, type = 'success') {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 4000);
                }
            }
        }
    </script>
</head>

<body x-data="portfolioApp()" x-init="init()" :class="{ 'dark': darkMode }" :dir="lang">
    
    <!-- UI Elements -->
    <header class="no-print sticky top-0 z-40 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm shadow-sm">
        <!-- Header Content Here -->
    </header>

    <div class="flex">
        <!-- Side Nav -->
        <nav class="no-print w-64 hidden md:block sticky top-16 h-[calc(100vh-4rem)] p-4 space-y-2 overflow-y-auto bg-gray-50 dark:bg-gray-800">
            <!-- Nav Links Here -->
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 lg:p-12">
            
            <!-- Loading Indicator -->
            <div x-show="isLoading" class="text-center p-12 text-gray-500" x-text="i18n[lang].loading"></div>

            <!-- Data Loading Error Message -->
            <div x-show="loadingError" x-cloak class="m-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                <h3 class="font-bold">خطأ في تحميل البيانات</h3>
                <p class="mt-2" x-text="loadingError"></p>
            </div>

            <!-- The Actual Portfolio Content -->
            <div x-show="!isLoading && !loadingError" x-cloak class="space-y-16">
                <!-- All sections from the original prompt go here, bound to the 'data' object -->
                <section id="header" data-aos="fade-up">
                    <div x-text="data.profile.fullName"></div>
                    <!-- and so on for all other elements -->
                </section>

            </div>
        </main>
    </div>

    <!-- Modals, FAB, Toasts etc. -->

</body>
</html>